# üìò –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è Terraform –∫–æ–¥—É –¥–ª—è –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ (Prometheus + Grafana + Node Exporter)

## –û–±—â–∏–π —Å–º—ã—Å–ª  
–≠—Ç–æ—Ç Terraform‚Äë–∫–æ–¥ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä—É–µ—Ç —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏–µ –±–∞–∑–æ–≤–æ–π –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –≤ **Yandex Cloud**. –û–Ω —Å–æ–∑–¥–∞—ë—Ç –≤–∏—Ä—Ç—É–∞–ª—å–Ω—É—é —Å–µ—Ç—å (VPC), –ø–æ–¥—Å–µ—Ç–∏ –∏ –≥—Ä—É–ø–ø—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏, –∞ —Ç–∞–∫–∂–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–µ –º–∞—à–∏–Ω—ã –¥–ª—è **Prometheus**, **Grafana** –∏ **Node Exporter**.  

–í –∏—Ç–æ–≥–µ –ø–æ–ª—É—á–∞–µ—Ç—Å—è –≥–æ—Ç–æ–≤–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:  
- **Node Exporter** –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ —Å–æ–±–∏—Ä–∞–µ—Ç —Å–∏—Å—Ç–µ–º–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏,  
- **Prometheus** —Ö—Ä–∞–Ω–∏—Ç –∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –º–µ—Ç—Ä–∏–∫–∏,  
- **Grafana** –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç —É–¥–æ–±–Ω—ã–µ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ –∏ –¥–∞—à–±–æ—Ä–¥—ã.  

–í–ê–ñ–ù–û: –≤ –∫–æ–¥–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ —Ö—Ä–∞–Ω–µ–Ω–∏–µ state –≤ S3Bucket YC (—Å –±–ª–æ–∫–∏—Ä–æ–≤–∫–æ–π —á–µ—Ä–µ–∑ ydb). –ù–µ –∑–∞–±—É–¥—å—Ç–µ —Å–æ–∑–¥–∞—Ç—å –∏–¥–µ–Ω—Ç–∏—á–Ω—É—é —Å–≤—è–∑–∫—É –∏ –ø–æ–º–µ–Ω—è—Ç—å —Ä–µ–∫–≤–∏–∑–∏—Ç—ã –≤ —Ñ–∞–π–ª–µ providers.tf. (endpoints –∏ dynamodb_table)

***

## –û—Å–Ω–æ–≤–Ω—ã–µ —à–∞–≥–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

### üîπ 1. VPC, –ø–æ–¥—Å–µ—Ç–∏ –∏ –≥—Ä—É–ø–ø—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
–ú–æ–¥—É–ª—å `yandex-vpc` —Å–æ–∑–¥–∞—ë—Ç:
- –≤–∏—Ä—Ç—É–∞–ª—å–Ω—É—é —Å–µ—Ç—å –∏ –ø–æ–¥—Å–µ—Ç—å –≤ –∑–∞–¥–∞–Ω–Ω–æ–π –∑–æ–Ω–µ;  
- security group `web` —Å –ø—Ä–∞–≤–∏–ª–∞–º–∏:  
  - –≤—Ö–æ–¥ HTTP (80) –∏ HTTPS (443),  
  - SSH –¥–æ—Å—Ç—É–ø (22),  
  - –ø–æ—Ä—Ç—ã –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞:  
    - 9090 (Prometheus),  
    - 9100 (Node Exporter),  
    - 3000 (Grafana),  
  - –ø–æ–ª–Ω—ã–π –∏—Å—Ö–æ–¥—è—â–∏–π —Ç—Ä–∞—Ñ–∏–∫ (egress).  

### üîπ 2. –í–∏—Ä—Ç—É–∞–ª—å–Ω—ã–µ –º–∞—à–∏–Ω—ã
–î–ª—è –∫–∞–∂–¥–æ–π —Ä–æ–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –º–æ–¥—É–ª—å `yandex-vm` —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ —Ä–µ—Å—É—Ä—Å–æ–≤ (—è–¥—Ä–∞, –ø–∞–º—è—Ç—å, –¥–∏—Å–∫, –ø—É–±–ª–∏—á–Ω—ã–π IP –∏ —Ç. –¥.) –∏ –æ–±—â–∏–º–∏ –ø—Ä–∞–≤–∏–ª–∞–º–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏.  

- **Prometheus VM**  
  - –•—Ä–∞–Ω–∏—Ç –∏ –∞–≥—Ä–µ–≥–∏—Ä—É–µ—Ç –º–µ—Ç—Ä–∏–∫–∏.  
  - –ü–æ–¥–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –Ω–∞ `node-exporter` —Ö–æ—Å—Ç—ã.  
  - –°–µ—Ä–≤–∏—Å –ø–æ–ª—É—á–∞–µ—Ç –ø–æ—Ä—Ç 9090.

- **Node Exporter VM**  
  - –†–∞–∑–≤—ë—Ä–Ω—É—Ç –∞–≥–µ–Ω—Ç —Å–±–æ—Ä–∞ –º–µ—Ç—Ä–∏–∫ –û–°.  
  - –°–µ—Ä–≤–∏—Å –¥–æ—Å—Ç—É–ø–µ–Ω –Ω–∞ –ø–æ—Ä—Ç—É 9100.  

- **Grafana VM**  
  - –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏.  
  - –î–æ—Å—Ç—É–ø–µ–Ω –ø–æ –ø–æ—Ä—Ç—É 3000 (–≤–µ–±‚Äë–¥–æ—Å—Ç—É–ø).  

–í—Å–µ –º–∞—à–∏–Ω—ã –ø–æ–ª—É—á–∞—é—Ç –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ —á–µ—Ä–µ–∑ cloud-init (`user-data`), –≥–¥–µ –º–æ–∂–Ω–æ –∑–∞–¥–∞—Ç—å SSH –∫–ª—é—á–∏ –∏ –±–∞–∑–æ–≤—É—é –Ω–∞—Å—Ç—Ä–æ–π–∫—É.

### üîπ 3. –î–∞–Ω–Ω—ã–µ –∏ —à–∞–±–ª–æ–Ω—ã  
–ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Ä–µ—Å—É—Ä—Å—ã `template_file` –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –≤ cloud-init —Ñ–∞–π–ª—ã (`prometheus.yml`, `node-exporter.yml`, `grafana.yml`).  
–¢–∞–∫–∂–µ —á–µ—Ä–µ–∑ `data "yandex_compute_image" "ubuntu"` –ø–æ–¥—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è –±–∞–∑–æ–≤—ã–π –æ–±—Ä–∞–∑ Ubuntu.  

***

## –†–µ–∑—É–ª—å—Ç–∞—Ç
–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∫–æ–º–∞–Ω–¥ `terraform apply`:  
- –í Yandex Cloud —Ä–∞–∑–≤—ë—Ä–Ω—É—Ç–∞ VPC —Å –ø–æ–¥—Å–µ—Ç—å—é –∏ –≥—Ä—É–ø–ø–æ–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏.  
- –°–æ–∑–¥–∞–Ω—ã —Ç—Ä–∏ –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–µ –º–∞—à–∏–Ω—ã: **Prometheus**, **Node Exporter** –∏ **Grafana**.  
- –í—Å–µ —Å–µ—Ä–≤–∏—Å—ã –º–æ–≥—É—Ç –≤–∑–∞–∏–º–Ω–æ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–æ–≤–∞—Ç—å –ø–æ –æ—Ç–∫—Ä—ã—Ç—ã–º –ø–æ—Ä—Ç–∞–º.  
- –î–æ—Å—Ç—É–ø –∫ –í–ú –≤–æ–∑–º–æ–∂–µ–Ω –ø–æ SSH‚Äë–∫–ª—é—á—É, —É–∫–∞–∑–∞–Ω–Ω–æ–º—É –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö.  

–¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, –≤–µ—Å—å —Å—Ç–µ–∫ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –ø–æ–¥–Ω–∏–º–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏ –≥–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é.  

***
