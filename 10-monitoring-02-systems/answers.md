# Домашнее задание к занятию "13.Системы мониторинга"

***

## 1. Вас пригласили настроить мониторинг на проект. На онбординге вам рассказали, что проект представляет из себя платформу для вычислений с выдачей текстовых отчетов, которые сохраняются на диск. Взаимодействие с платформой осуществляется по протоколу http. Также вам отметили, что вычисления загружают ЦПУ. Какой минимальный набор метрик вы выведите в мониторинг и почему?

Проект — платформа для вычислений с выдачей текстовых отчетов по HTTP, с высокой нагрузкой на CPU и сохранением отчетов на диск.

### HTTP-метрики
- **Количество запросов (RPS)** — понимание текущей нагрузки на сервис.
- **Процент успешных и ошибочных ответов (2xx, 4xx, 5xx)** — определение наличия ошибок.
- **Время ответа (latency)** — выявление деградаций производительности.

**Почему:** HTTP — основной интерфейс работы с системой, сбои напрямую влияют на доступность.

### Системные метрики
- **Загрузка CPU** — для контроля производительности.
- **Использование оперативной памяти (RAM)** — предотвращение ошибок из-за нехватки памяти.
- **Свободное место на диске** — защита от сбоев при сохранении отчетов.
- **I/O диска** — контроль скорости работы диска.

**Почему:** сбои в ресурсах могут существенно повлиять на работу сервиса.

***

## 2. Менеджер продукта посмотрев на ваши метрики сказал, что ему непонятно что такое RAM/inodes/CPUla. Также он сказал, что хочет понимать, насколько мы выполняем свои обязанности перед клиентами и какое качество обслуживания. Что вы можете ему предложить?

### Метрики, понятные бизнесу (SLI/SLO)
- Доля успешно обработанных клиентских запросов.
- Среднее/максимальное время отклика сервиса.
- Среднее время выполнения задач.
- Процент задач с ошибками.

### SLA
- Пример: 99% отчётов готовы за ≤10 минут без ошибок.

***

## 3. Вашей DevOps команде в этом году не выделили финансирование на построение системы сбора логов. Разработчики в свою очередь хотят видеть все ошибки, которые выдают их приложения. Какое решение вы можете предпринять в этой ситуации, чтобы разработчики получали ошибки приложения?

### Бесплатные и open-source решения

**Sentry (self-hosted)**  
- Open-source система для сбора ошибок.
- Поддерживает основные языки.
- Минимальные затраты на инфраструктуру.
- Уведомления через email, Slack и т.д.

***

## 4. Вы, как опытный SRE, сделали мониторинг, куда вывели отображения выполнения SLA=99% по http кодам ответов. Вычисляете этот параметр по следующей формуле: summ_2xx_requests/summ_all_requests. Данный параметр не поднимается выше 70%, но при этом в вашей системе нет кодов ответа 5xx и 4xx. Где у вас ошибка?

**Почему 70%, если нет 4xx и 5xx:**  
- В расчёт успешных запросов входят только **2xx**.
- Остальные, например **3xx**, считаются в denominator, но не в успешных.

**Ошибка:**  
- Успешными могут быть не только 2xx, но и некоторые 3xx (редиректы, нормальные для сервиса).

**Исправленный расчёт:**
```
SLA = (запросы с кодами 200–399) / (все запросы)
```

***

## 5. Опишите основные плюсы и минусы pull и push систем мониторинга.

### Pull-модель  
**Плюсы:**
- Централизованное управление и опрос.
- Безопасность: сервер инициирует подключение.
- Разная частота опроса целей.
- Удобное исключение временно недоступных целей.

**Минусы:**
- Проблемы за NAT и firewall.
- Нет метрик "задним числом".
- Меньше возможностей агентов.
- Сложно для распределённых систем.

***

### Push-модель  
**Плюсы:**
- Работает через NAT/firewall.
- Гибкость в частоте отправки данных.
- Подходит для краткоживущих задач.
- Не нужно знать всех клиентов на сервере.

**Минусы:**
- Нет возможности запросить данные по требованию.
- Риск потери данных.
- Возможны скачки нагрузки при массовой отправке.
- Требуется открытый endpoint (вопрос безопасности).

***

## 6. Какие из ниже перечисленных систем относятся к push модели, а какие к pull? А может есть гибридные?

| Система           | Модель                 | Пояснение |
|-------------------|------------------------|-----------|
| **Prometheus**    | В основном pull, гибрид с Pushgateway | Основной сбор — pull, Pushgateway для push данных. |
| **TICK**          | Push                    | Telegraf отправляет данные в InfluxDB. |
| **Zabbix**        | Гибрид                  | Поддержка и активного (push), и пассивного (pull) сбора. |
| **VictoriaMetrics** | Pull, гибрид           | Поддержка режима Prometheus и приём push-метрик. |
| **Nagios**        | Pull, гибрид            | Активные проверки (pull) плюс пассивные проверки (push). |
